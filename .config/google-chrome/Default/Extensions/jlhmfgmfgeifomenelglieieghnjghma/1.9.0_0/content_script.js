var ContentScript=function(p){return p.id=chrome.runtime.id,p.port=null,p.token_="",p.hashList=[],p.uuid_="",p.initHashList=function(){p.hashList.push("X4WKTojPTBCkUep3mJ4lISkJd5xjgCy7t3WOV9ekcYQ="),p.hashList.push("64tUupzAFkz0sO9FdxdKzXPU1M+kX5addpE8cY8KwMY="),p.hashList.push("Y1UGgNTP1Q1s+ApMq8hsYXhEOhDHsCr5/q5bbvBFP/c="),p.hashList.push("eaShT5BXYGibkON42a7ewRxsy4+PSGtTMh2fG54Zf7A="),p.hashList.push("bzT9bgmTETuVqCgVxPDSjrnTqC6N14zH8kVD/pHJBdw="),p.hashList.push("Y1KRUKo4HpiaxizSb9jeqQR7pL82VYHg0CMQHD0EHHI="),p.hashList.push("1bIZVrqEKHJbytsxxLWDyOXWT4CQO7K46V4lOryJIJo=")},p.uuid=function(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"===e?t:7&t|8).toString(16)})},p.filterLog=function(e){var t={};for(var n in e){var o=e[n];if(n.match(/location\d+_url|szhomepage\d+/i))try{var r=document.createElement("a");if(r.href=atob(o),r.hostname.trim().toLowerCase().match(/webex\.com$|webex\.com\.cn$|^_self$/i))continue}catch(e){}else if("clientparam_value"===n.trim().toLowerCase()){var a=(new DOMParser).parseFromString(atob(o),"text/xml");if(a&&"root"===a.childNodes[0].nodeName)continue}else if(o.match(/^\d+$|^\d+\.\d+$/))continue;t[n]=o}return t},p.sendLog=function(t,e){try{var n="string"==typeof t.message?JSON.parse(t.message):t.message;n.ext_message_type=t.message_type,n.ext_tracking_id=p.uuid_,n.domain=window.location.protocol+"//"+window.location.host,n.illegal=!!e,chrome.runtime.sendMessage(n,function(e){})}catch(e){chrome.runtime.sendMessage(t.message,function(e){})}},p.verifyScriptCall=function(e){var t=/^(WebEx_|As[ADEPS]|RA[AM])|^(Ex|In)it|^(FinishC|Is[NS]|JoinM|[NM][BCS][JRUC]|Set|Name|Noti|Trans|Update)|^(td|SCSP)$/;if(20480<e.length)return!1;for(var n=e.split(";"),o=0;o<n.length;o++){var r=n[o].trim(),a="",s=r.indexOf("=");if(0<=s){if("szCookie"!==r.substring(0,s).trim())return!1;r=r.substring(s+1).trim()}0<=(s=r.indexOf("("))&&(a=r.substring(s+1),r=r.substring(0,s).trim());var i=a.split(",");if(1024<a.length||20<i.length)return!1;if(0<r.length&&!r.match(t))return!1;if(r.match(/2$/))return!1;for(var c=p.crypto(r),m=0;m<p.hashList.length;m++)if(c===p.hashList[m])return!1}return!0},p.verify=function(e){if("connect"!==e.message_type&&"disconnect"!==e.message_type&&"launch_meeting"!==e.message_type)return!1;if("launch_meeting"!==e.message_type)return!0;try{if("string"!=typeof e.message)return!1;if(e.message.includes("\\u0000"))return!1;var t=JSON.parse(e.message);if(navigator.platform.match(/win/i)){if((a=t.GpcExtName)&&"atgpcext"!=(a=a.trim()).toLowerCase()&&"atgpcext"!=atob(a).toLowerCase().trim())return!1;var n=t.GpcUnpackName;if(n&&"atgpcdec"!=(n=n.trim()).toLowerCase()&&"atgpcdec"!=atob(n).toLowerCase().trim())return!1;var o=t.GpcInitCall;if(o&&!p.verifyScriptCall(atob(o.trim())))return!1;var r=t.GpcExitCall;if(r&&!p.verifyScriptCall(atob(r.trim())))return!1}else{if(!navigator.platform.match(/mac/i))return!1;var a;if("atgpcext64"!=(a=t.GpcExtName.trim()).toLowerCase()&&"atgpcext64"!=atob(a).toLowerCase().trim())return!1}var s=t.GpcComponentName.toLowerCase().trim();return null==s.match(/\.dll$|\.bundle$|\.app$/)&&(s=(s=atob(t.GpcComponentName)).toLowerCase().trim()),!0}catch(e){}return!1},p.handleStateChanged=function(e){console.info("[ContentScript] handleStateChanged: result=",e);var t={timestamp:(new Date).toUTCString(),token:p.token_,message_type:"state_changed",message:{ExtState:{result:e,reason:e?"ok":"ExtensionNotInstalled"},HostState:{result:!1,reason:"HostNotInstalled"}}};p.handleNativeMessage(t)},p.handleNativeMessage=function(e){console.info("[ContentScript] handleNativeMessage: message=",e),"hello_ack"===e.message_type&&p.sendLog(e);var t=new CustomEvent("native_message",{detail:e});window.parent.document.dispatchEvent(t)},p.handleNativeDisconnect=function(e){console.info("[ContentScript] port.onDisconnect: self.port=",p.port);var t={timestamp:(new Date).toUTCString(),token:p.token_,message_type:"disconnect",message:"disconnect"};p.port=null,p.handleNativeMessage(t)},p.sendMessage=function(e,t){console.info("[ContentScript] sendMessage: self.port=",p.port),console.info("[ContentScript] sendMessage: message=",e);try{if(!p.verify(e)){"launch_meeting"===e.message_type&&p.sendLog(e,!0);var n={timestamp:(new Date).toUTCString(),token:p.token_,message_type:"error",message:{error_code:1005,error_message:"BadDocShow"}};if(p.handleNativeMessage(n),null!=p.port){var o={timestamp:(new Date).toUTCString(),token:p.token_,message_type:"disconnect",message:"disconnect"};p.port.postMessage(o)}return}"launch_meeting"===e.message_type&&(e.domain=window.location.protocol+"//"+window.location.host),null!=p.port&&p.port.postMessage(e),"launch_meeting"===e.message_type&&p.sendLog(e)}catch(e){n={timestamp:(new Date).toUTCString(),token:p.token_,message_type:"error",message:{error_code:-1,error_message:e.toString()}};p.handleNativeMessage(n)}},p.connectPort=function(e){var t=window.location.host;if(console.info("[ContentScript] connectPort: extId=",e,"self.port=",p.port,"host=",t),!p.port)try{p.port=chrome.runtime.connect(e,{name:p.token_}),console.info("[ContentScript] connectPort: self.port=",p.port,"now=",performance.now()),null!=p.port&&(p.port.onMessage.addListener(p.handleNativeMessage),p.port.onDisconnect.addListener(p.handleNativeDisconnect))}catch(e){console.info("[ContentScript] connectPort: err=",e),ContentScript.handleStateChanged(!1)}},p.crypto=function(e){return CryptoJS.SHA256(e).toString(CryptoJS.enc.Base64)},p.init=function(){console.info("[ContentScript] init: chrome.runtime.id=",chrome.runtime.id),p.initHashList(),p.uuid_=p.uuid(),document.addEventListener("connect",function(e){console.info("[ContentScript] connect: e=",e),p.token_=e.detail.token,p.connectPort(chrome.runtime.id)}),document.addEventListener("message",function(e){console.info("[ContentScript] message: e=",e),p.sendMessage(e.detail,p.handleNativeMessage)})},p}(ContentScript||{});ContentScript.init(),window.onload=function(){ContentScript.handleStateChanged(!0)};