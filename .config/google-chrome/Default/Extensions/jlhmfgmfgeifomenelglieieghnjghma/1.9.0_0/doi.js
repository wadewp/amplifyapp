"use strict";var doi={conf:{xhrHeader:{}},util:{},io:{},ticker:{liveCounter:0,actionRepo:[],onTick:function(e){this.actionRepo.push(e)},off:function(e){var t=this.actionRepo.indexOf(e);-1<t&&this.actionRepo.splice(t,1)},clear:function(){this.actionRepo=[]},trigger:function(){for(var e in this.liveCounter++,this.actionRepo)"function"==typeof this.actionRepo[e]&&this.actionRepo[e]()},intervalTick:function(){doi.ticker.trigger()}}};"undefined"!=typeof global&&(doi.conf.inNodeMode=!0,global.window=global,window.XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,module.exports=doi),window.doi=doi,window.setInterval(doi.ticker.intervalTick,100),window.doi.conf.abbrMapping={correlateID:"cid",product:"pd",telemetryVersion:"ver",timestamp:"ts",tsID:"tid",type:"t",values:"v"},function(){var e=window.doi,n=e.conf,t=e.util;function i(e){return"[object Array]"===Object.prototype.toString.call(e)}function o(e){return!(i(e)||(t=e,"[object Object]"===Object.prototype.toString.call(t)));var t}function a(e){var t=n.abbrMapping;for(var r in t)if(e===r)return t[r];return e}t._keyAbbreviator=a,t.abbreviate=function e(t){if(o(t))return t;var r=i(t)?[]:{};for(var n in t)r[a(n)]=e(t[n]);return r}}(),function(){var e=window.doi.conf;e.validation={AgentInfo:{required:["os","language","region","browser","timezone"],checkList:{os:["string"],language:["string"],region:["string"],browser:["string"],timezone:["string"],tzName:["string"],deviceModel:["string"],deviceInfo:["string"],localIP:["string"],geoLocation:["string"]}},Info:{required:["category","userID","version"],checkList:{category:["string",["Conference","PT","Call","Room","Message","Session"]],userID:["string"],version:["string"],extVal:["object"]}},PageView:{required:["title","location"],checkList:{title:["string"],location:["string"],page:["string"],extVal:["object"]}},ScreenView:{required:["screenName"],checkList:{screenName:["string"],extVal:["object"]}},Action:{required:["category","action","uiSource"],checkList:{category:["string"],action:["string"],uiSource:["string"],label:["string"],value:["string"],interaction:["string",["mouse","voiceOver","keyboard","gesture","tap"]],trackingID:["string"],extVal:["object"]}},Event:{required:["category","event"],checkList:{category:["string"],event:["string"],label:["string"],value:["number"],trackingID:["string"],extVal:["object"]}},Timing:{required:["category","value"],checkList:{category:["string"],value:["number"],label:["string"],start:["string"],extVal:["object"]}},Counter:{required:["category","value"],checkList:{category:["string"],value:["number"],label:["string"],extVal:["object"]}},Quality:{required:["category","value"],checkList:{category:["string",["meeting","audio","video","share"]],value:["string"],extVal:["object"]}},Exception:{required:["category","value"],checkList:{category:["string"],value:["string"],extVal:["object"]}}},e.TYPE={AGENTINFO:"AgentInfo",INFO:"Info",PAGEVIEW:"PageView",SCREENVIEW:"ScreenView",ACTION:"Action",EVENT:"Event",TIMING:"Timing",COUNTER:"Counter",QUALITY:"Quality",EXCEPTION:"Exception"}}(),function(){var e=window.doi,u=e.conf,t=e.util,d=u._VALIDATERESULT={PASSED:"Passed.",OBJECT_MISSED:"Validate object is missed.",REQUIRED_PARAM_MISSED:'Missed required parameter: "{0}".',UNDEFINED_TYPE:'"{0}" is not a expected type.',WRONG_VALUE_TYPE:"Wrong type of property: {0}.",WRONG_VALUE:"Wrong value of property: {0}.",UNACCEPTABLE_PARAM:'Parameter "{0}" is unexpected.'};function g(e,t){return{pass:e,reason:t}}function l(e,t){return e.replace(/\{0\}/,t)}t.validate=function(e){if(!e)return g(!1,d.OBJECT_MISSED);var t=e.values,r=e.type;if(!r)return g(!1,l(d.REQUIRED_PARAM_MISSED,"type"));if(!t)return g(!1,l(d.REQUIRED_PARAM_MISSED,"values"));if(!function(e){for(var t in u.TYPE)if(u.TYPE[t]===e)return!0;return!1}(r))return g(!1,l(d.UNDEFINED_TYPE,r));var n,i=u.validation[r],o=i.required,a=i.checkList;for(var s in o)if(void 0===t[o[s]])return g(!1,l(d.REQUIRED_PARAM_MISSED,o[s]));for(var c in t){if(!a[c])return g(!1,l(d.UNACCEPTABLE_PARAM,c));if(typeof t[c]!==a[c][0])return g(!1,l(d.WRONG_VALUE_TYPE,'"'+c+'" should be '+a[c][0]));if(a[c][1]&&(n=t[c],-1===a[c][1].indexOf(n)))return g(!1,l(d.WRONG_VALUE,'"'+c+'" should be in array ['+a[c][1].join(", ")+"]"))}return g(!0,d.PASSED)}}(),function(){var r=window.doi,a=r.conf,o=r.util,i=r.io,s=i._QUEUE=[],c=i._SENDING=[];function n(e,t){a.xhrHeader[e]=t}function t(e){for(var t="",r=0;r<e;r++)t+="0123456789abcdef"[16*Math.random()|0];return t}function u(){var e=t;return[e(8),e(4),e(4),e(4),e(12)].join("-")}function d(){function e(e,t){return("000"+e).slice(-t)}var t=new Date,r=e(-t.getTimezoneOffset()/60*100,4);return[e(t.getFullYear(),4),"-",e(t.getMonth()+1,2),"-",e(t.getDate(),2),"T",e(t.getHours(),2),":",e(t.getMinutes(),2),":",e(t.getSeconds(),2),".",e(t.getMilliseconds(),3),0<r?"+":"-",r].join("")}function g(e,t){var r=a.logger,n={type:e,ts:d(),tid:a.TID,cid:a.CID,pd:a.product,ver:"2.0",values:t},i=o.validate(n);i.pass||(r.warn("[doi warn]Data validate failed, reason: "+i.reason),r.warn(n)),a.retryCounter=a.retry,s.push(o.abbreviate(n)),"storage"===a.saveMode&&sessionStorage.setItem("doiQueue",JSON.stringify(s))}function e(){var e,t,r=a.logger,n=a.xhrHeader,i=!1;if(a.isInited){if(a.tickCounter=0,s.length){for(var o in(e=new XMLHttpRequest).open("POST",a.URL,!0),n)e.setRequestHeader(o,n[o]);e.onreadystatechange=function(){4===this.readyState&&(200===this.status?(r.info("[doi info]doi send data success."),a.retryCounter=a.retry):(r.warn("[doi warn]doi send data failed."),a.retryCounter&&(s.push.apply(s,c),c.splice(0,c.length)),this.abort()),i=!0)},setTimeout(function(){i||(e.abort(),r.warn("[doi warn]doi send data failed, reason: timeout."),i=!0)},6e4),r.info("[doi info]doi sending start."),e.send((t=s.splice(0,s.length),"storage"===a.saveMode&&sessionStorage.removeItem("doiQueue"),a.retryCounter&&c.push.apply(c,t),JSON.stringify({telemetrics:t}))),a.retryCounter&&a.retryCounter--}}else r.warn("[doi warn]doi initialed flag are false.")}function l(){++a.tickCounter>=10*a.interval&&s.length&&e()}function f(r){var e=r&&r.logger?r.logger:a.logger||console;if(r){if(r.TID=r.sessionID,r.noCache=r.immediateSend,r.retry||(r.retry=!0===r.resendMatric?3:!1===r.resendMatric?0:r.resendMatric),n("retry",3),n("product","unknown"),n("interval",300),n("TID",u()),n("noCache",!1),n("logger",e),a.retryCounter=a.retry,a.saveMode="memory","storage"===r.saveMode){if(window.sessionStorage){var t=sessionStorage.getItem("doiQueue");a.storageEnable=!0,t&&(s=i._QUEUE=JSON.parse(t)),a.saveMode="storage"}}else a.saveMode="memory";a.CID=u()}else e.error("[doi error]Parameter is empty.");function n(e,t){void 0!==r[e]?a[e]=r[e]:void 0!==a[e]?a[e]=a[e]:a[e]=t}}i.init=function(e){var t=e&&e.logger?e.logger:console;window.XMLHttpRequest||window.ActiveXObject?e&&e.URL&&e.appID?(f(e),a.URL=e.URL,a.tickCounter=a.tickCounter||0,a.isInited=!0,n("appId",e.appID),n("Content-Type","text/plain"),n("ver","2.0"),r.ticker.onTick(l),"undefined"!=typeof top&&g(a.TYPE.PAGEVIEW,{title:top.document.title,location:top.location.href})):t.error("[doi error]Missed required parameters to initial doi."):t.error("[doi error]Critical Err, require XMLHttpRequest support.")},i.setup=f,i.getSessionID=function(){return a.TID?a.TID:""},i.setHeader=n,i.save=g,i.send=e}(),function(){var e=window.doi,i=e.conf,n=e.io,o={trackingId:1,anchor:{}},a=o.anchor;e.ticker.onTick(function(){var e=o.anchor;for(var t in e)0==--e[t].countdown&&(n.save(i.TYPE.EXCEPTION,{category:e[t].category,value:"timeout"}),delete e[t])}),n.startTimeTrace=function(e,t){var r=i.logger;if(!e)return r.error("[doi Error]Missed required parameter to start time trace."),0;var n=o.trackingId++;return a[n]={trackingId:n,startTime:+new Date,category:e,countdown:+t||120},n},n.sendTimeTrace=function(e){var t=i.logger,r=a[e];e?e&&r&&(n.save(i.TYPE.TIMING,{category:r.category,value:new Date-r.startTime}),delete a[e]):t.error("[doi Error]Missed required parameter to send time trace.")}}(),function(){var n=window.doi,i=n.io;n.setup=function(e){i.setup(e)},n.init=function(e){i.init(e)},n.getSessionID=function(){return i.getSessionID()},n.setHeader=function(e,t){i.setHeader(e,t)},n.sendInfo=function(e){n.send("Info",e,!1)},n.sendScreenView=function(e){n.send("ScreenView",e,!1)},n.sendAction=function(e){n.send("Action",e,!1)},n.sendEvent=function(e){n.send("Event",e,!1)},n.sendTiming=function(e){n.send("Timing",e,!1)},n.sendCounter=function(e){n.send("Counter",e,!1)},n.sendQuality=function(e){n.send("Quality",e,!1)},n.sendException=function(e){n.send("Exception",e,!1)},n.startTimeTrace=function(e,t){return i.startTimeTrace(e,t)},n.sendTimeTrace=function(e){i.sendTimeTrace(e)},n.send=function(e,t,r){i.save(e,t),(n.conf.noCache||r)&&i.send()},n.sendImmediately=function(){i.send()},n.close=function(){i.send()}}();